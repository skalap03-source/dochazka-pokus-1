<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Docházkový panel</title>
<style>
  body {
    font-family: sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f0f0f0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #modal {
    background-color: white;
    padding: 30px 40px;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    min-width: 320px;
    max-width: 400px;
    text-align: center;
  }

  h2 {
    margin-top: 0;
  }

  label {
    display: block;
    text-align: left;
    margin-bottom: 10px;
    font-weight: bold;
  }

  input, select {
    width: 100%;
    padding: 8px;
    font-size: 16px;
    margin-top: 4px;
    margin-bottom: 15px;
  }

  button {
    padding: 14px 24px;
    font-size: 16px;
    font-weight: bold;
    margin: 8px 6px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }

  .green { background-color: #4CAF50; color: black; }
  .red { background-color: #F44336; color: black; }
  .blue { background-color: #2196F3; color: white; }
  .grey { background-color: #888888; color: white; }

  #panel button {
    min-width: 120px;
  }

  #logoutBtn {
    position: absolute;
    top: 20px;
    right: 20px;
  }

</style>
</head>
<body>

<div id="modal">

  <!-- Přihlášení -->
  <div id="login">
    <h2>Přihlášení</h2>
    <label>Jméno a příjmení:
      <input type="text" id="jmeno">
    </label>
    <label>Místo:
      <select id="misto">
        <option value="Brandýs">Brandýs</option>
        <option value="Dejvice">Dejvice</option>
        <option value="Harfa">Harfa</option>
        <option value="Máj">Máj</option>
        <option value="Nábřeží">Nábřeží</option>
        <option value="Ořechovka">Ořechovka</option>
        <option value="Pražačka">Pražačka</option>
        <option value="Příbram">Příbram</option>
        <option value="Sofijské náměstí">Sofijské náměstí</option>
        <option value="Uhříněves">Uhříněves</option>
        <option value="Vypich">Vypich</option>
        <option value="Vyšehrad">Vyšehrad</option>
      </select>
    </label>
    <button class="blue" onclick="prihlasit()">Pokračovat</button>
  </div>

  <!-- Docházkový panel -->
  <div id="panel" style="display:none;">
    <h2>Docházkový panel</h2>
    <p id="uzivatel" style="font-weight:bold;"></p>

    <!-- Příchod / Odchod -->
    <div>
      <button class="green" onclick="zapsatDochazku('Příchod')">Příchod</button>
      <button class="red" onclick="zapsatDochazku('Odchod')">Odchod</button>
    </div>

    <!-- Kropení / Hrabaní -->
    <div>
      <button class="grey" onclick="zapsatInterval('Kropení')">Kropení</button>
      <button class="grey" onclick="zapsatInterval('Hrabaní')">Hrabaní</button>
    </div>

    <button id="logoutBtn" class="blue" onclick="odhlasit()">Odhlásit ⎋</button>
  </div>

</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyEMgvCCtdwZ2d05osFDaUgYjmqNGNJSHndXUVtBsviSB7e3a0sIK4woEYRKKK4pwsDdQ/exec";

function prihlasit() {
  const jmeno = document.getElementById('jmeno').value.trim();
  const misto = document.getElementById('misto').value;
  if (!jmeno) { alert('Zadej jméno'); return; }

  sessionStorage.setItem('jmeno', jmeno);
  sessionStorage.setItem('misto', misto);

  document.getElementById('login').style.display = "none";
  document.getElementById('panel').style.display = "block";
  document.getElementById('uzivatel').innerText = `${jmeno} (${misto})`;
}

function odhlasit() {
  sessionStorage.clear();
  document.getElementById('panel').style.display = "none";
  document.getElementById('login').style.display = "block";
}

function zapsatInterval(typ){
  const jmeno = sessionStorage.getItem('jmeno');
  const misto = sessionStorage.getItem('misto');
  const cas = new Date().toLocaleString('cs-CZ');

  const data = { jmeno, misto, typ, cas, action: "interval" };

  fetch(scriptURL,{
    method:'POST',
    headers:{'Content-Type':'application/x-www-form-urlencoded'},
    body: new URLSearchParams(data)
  })
  .then(response => response.text())
  .then(result => alert(result))
  .catch(err => alert("Chyba: " + err));
}

function zapsatDochazku(typ){
  const jmeno = sessionStorage.getItem('jmeno');
  const misto = sessionStorage.getItem('misto');

  const data = { jmeno, misto, typ, action:"dochazka" };

  fetch(scriptURL,{
    method:'POST',
    headers:{'Content-Type':'application/x-www-form-urlencoded'},
    body: new URLSearchParams(data)
  })
  .then(response => response.text())
  .then(result => alert(result))
  .catch(err => alert("Chyba: " + err));
}
</script>

</body>
</html>

